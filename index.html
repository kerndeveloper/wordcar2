<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Car Word Game - Phase 2.5</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            overflow: hidden;
            font-family: Arial, sans-serif;
            background: #000;
        }
        
        #gameCanvas {
            display: block;
            width: 100vw;
            height: 100vh;
            touch-action: none;
        }
        
        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            font-size: 18px;
            z-index: 10;
            font-weight: bold;
        }
        
        .highlight {
            color: #ffff00;
            font-size: 20px;
        }
        
        .controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 10;
        }
        
        .btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 100, 100, 0.8);
            border: 4px solid white;
            border-radius: 50%;
            color: white;
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        
        .btn:active {
            background: rgba(255, 200, 200, 0.9);
            transform: scale(0.9);
        }
        
        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .btn-row {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div id="ui">
        üöó <strong>DRIVE THE RED CAR!</strong><br>
        Position: <span class="highlight" id="position">0, 0</span><br>
        FPS: <span id="fps">60</span>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    
    <div class="controls">
        <div class="btn-group">
            <div class="btn-row">
                <div class="btn" id="btnUp">‚Üë</div>
            </div>
            <div class="btn-row">
                <div class="btn" id="btnLeft">‚Üê</div>
                <div class="btn" id="btnDown">‚Üì</div>
                <div class="btn" id="btnRight">‚Üí</div>
            </div>
        </div>
    </div>

    <script>
        'use strict';
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const fpsEl = document.getElementById('fps');
        const positionEl = document.getElementById('position');
        
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // MUCH CLOSER CAMERA for better visibility
        function project3D(x, y, z) {
            const cameraX = carX;
            const cameraY = 4; // Lower camera
            const cameraZ = carZ + 6; // MUCH closer
            
            const relX = x - cameraX;
            const relY = y - cameraY;
            const relZ = z - cameraZ;
            
            if (relZ >= -0.5) return null;
            
            const scale = 600 / (-relZ); // Bigger scale
            return {
                x: canvas.width / 2 + relX * scale,
                y: canvas.height / 2 + relY * scale,
                scale: scale
            };
        }
        
        // Game state
        let carX = 0;
        let carZ = 0;
        const carSpeed = 0.3; // Even faster
        
        // Input
        const keys = {};
        
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            e.preventDefault();
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // Touch controls
        function setupButton(id, key) {
            const btn = document.getElementById(id);
            
            const activate = (e) => {
                e.preventDefault();
                keys[key] = true;
            };
            
            const deactivate = (e) => {
                e.preventDefault();
                keys[key] = false;
            };
            
            btn.addEventListener('touchstart', activate);
            btn.addEventListener('touchend', deactivate);
            btn.addEventListener('mousedown', activate);
            btn.addEventListener('mouseup', deactivate);
            
            // Prevent stuck buttons
            btn.addEventListener('touchcancel', deactivate);
            document.addEventListener('touchend', deactivate);
        }
        
        setupButton('btnUp', 'ArrowUp');
        setupButton('btnDown', 'ArrowDown');
        setupButton('btnLeft', 'ArrowLeft');
        setupButton('btnRight', 'ArrowRight');
        
        // Draw BIGGER, CLEARER car
        function drawCar() {
            // Main body - BRIGHT RED
            drawBox(carX, 0.7, carZ, 3, 1.2, 5, '#ff0000');
            
            // Cabin - ORANGE for contrast
            drawBox(carX, 1.6, carZ - 0.5, 2.5, 0.8, 3, '#ff6600');
            
            // Hood - YELLOW
            drawBox(carX, 0.4, carZ - 3, 2.8, 0.4, 1, '#ffff00');
            
            // Draw BIG wheels
            const wheelPositions = [
                { x: -1.2, z: -1.8 },
                { x: 1.2, z: -1.8 },
                { x: -1.2, z: 1.8 },
                { x: 1.2, z: 1.8 }
            ];
            
            wheelPositions.forEach(wheel => {
                const pos = project3D(carX + wheel.x, 0.4, carZ + wheel.z);
                if (pos) {
                    ctx.fillStyle = '#000';
                    ctx.beginPath();
                    ctx.arc(pos.x, pos.y, 15 * pos.scale, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = '#666';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
            
            // Draw windows (cyan/blue for visibility)
            drawBox(carX, 1.6, carZ - 1, 2.2, 0.6, 1.5, '#00ffff');
        }
        
        function drawBox(x, y, z, width, height, depth, color) {
            const w = width / 2;
            const h = height / 2;
            const d = depth / 2;
            
            const corners = [
                project3D(x - w, y - h, z - d),
                project3D(x + w, y - h, z - d),
                project3D(x + w, y + h, z - d),
                project3D(x - w, y + h, z - d),
                project3D(x - w, y - h, z + d),
                project3D(x + w, y - h, z + d),
                project3D(x + w, y + h, z + d),
                project3D(x - w, y + h, z + d)
            ];
            
            if (corners.some(c => c === null)) return;
            
            function drawFace(indices, faceColor) {
                ctx.beginPath();
                ctx.moveTo(corners[indices[0]].x, corners[indices[0]].y);
                for (let i = 1; i < indices.length; i++) {
                    ctx.lineTo(corners[indices[i]].x, corners[indices[i]].y);
                }
                ctx.closePath();
                ctx.fillStyle = faceColor;
                ctx.fill();
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 3;
                ctx.stroke();
            }
            
            // Draw all faces with shading
            drawFace([0, 1, 2, 3], shadeColor(color, 0.4));
            drawFace([0, 4, 7, 3], shadeColor(color, 0.6));
            drawFace([1, 5, 6, 2], shadeColor(color, 0.7));
            drawFace([0, 1, 5, 4], shadeColor(color, 0.5));
            drawFace([3, 2, 6, 7], shadeColor(color, 0.9));
            drawFace([4, 5, 6, 7], color);
        }
        
        function shadeColor(color, factor) {
            const num = parseInt(color.slice(1), 16);
            const r = Math.floor(((num >> 16) & 0xFF) * factor);
            const g = Math.floor(((num >> 8) & 0xFF) * factor);
            const b = Math.floor((num & 0xFF) * factor);
            return `rgb(${r},${g},${b})`;
        }
        
        // Simpler, BOLDER grid
        function drawGround() {
            ctx.strokeStyle = '#1a4d1a';
            ctx.lineWidth = 3;
            
            for (let i = -8; i <= 8; i++) {
                const start1 = project3D(i * 3, 0, -20);
                const end1 = project3D(i * 3, 0, 20);
                
                if (start1 && end1) {
                    ctx.beginPath();
                    ctx.moveTo(start1.x, start1.y);
                    ctx.lineTo(end1.x, end1.y);
                    ctx.stroke();
                }
                
                const start2 = project3D(-20, 0, i * 3);
                const end2 = project3D(20, 0, i * 3);
                
                if (start2 && end2) {
                    ctx.beginPath();
                    ctx.moveTo(start2.x, start2.y);
                    ctx.lineTo(end2.x, end2.y);
                    ctx.stroke();
                }
            }
        }
        
        // BIG test letters
        function drawTestLetters() {
            const letters = [
                { x: -5, z: -8, color: '#ffff00' },
                { x: 0, z: -12, color: '#ff00ff' },
                { x: 5, z: -16, color: '#00ffff' }
            ];
            
            letters.forEach(letter => {
                drawBox(letter.x, 1, letter.z, 2, 2, 2, letter.color);
            });
        }
        
        function update() {
            if (keys['ArrowUp'] || keys['w']) carZ -= carSpeed;
            if (keys['ArrowDown'] || keys['s']) carZ += carSpeed;
            if (keys['ArrowLeft'] || keys['a']) carX -= carSpeed;
            if (keys['ArrowRight'] || keys['d']) carX += carSpeed;
            
            carX = Math.max(-12, Math.min(12, carX));
            carZ = Math.max(-18, Math.min(18, carZ));
            
            positionEl.textContent = `${carX.toFixed(1)}, ${carZ.toFixed(1)}`;
        }
        
        function draw() {
            // Sky
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#B0E0E6');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Ground
            ctx.fillStyle = '#228B22';
            ctx.fillRect(0, canvas.height * 0.4, canvas.width, canvas.height * 0.6);
            
            drawGround();
            drawTestLetters();
            drawCar();
        }
        
        // FPS counter
        let lastTime = performance.now();
        let frameCount = 0;
        
        function gameLoop(currentTime) {
            frameCount++;
            
            if (currentTime - lastTime >= 1000) {
                fpsEl.textContent = frameCount;
                frameCount = 0;
                lastTime = currentTime;
            }
            
            update();
            draw();
            
            requestAnimationFrame(gameLoop);
        }
        
        requestAnimationFrame(gameLoop);
    </script>
</body>
</html>
